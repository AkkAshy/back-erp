# üìò –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é Customers (CRM)

## üéØ –û–±–∑–æ—Ä

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ **Customers** –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—É—é CRM-—Å–∏—Å—Ç–µ–º—É –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–∫—É–ø–∞—Ç–µ–ª—è–º–∏ –≤ ERP v2.

### –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:
- ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–∫—É–ø–∞—Ç–µ–ª—è–º–∏ (—Ñ–∏–∑. –∏ —é—Ä. –ª–∏—Ü–∞)
- ‚úÖ –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π —Å –∞–≤—Ç–æ—Å–∫–∏–¥–∫–∞–º–∏
- ‚úÖ –ö—Ä–µ–¥–∏—Ç–Ω—ã–µ –ª–∏–º–∏—Ç—ã –∏ –±–∞–ª–∞–Ω—Å –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π
- ‚úÖ –ü—Ä–æ–≥—Ä–∞–º–º–∞ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ (–±–æ–Ω—É—Å–Ω—ã–µ –±–∞–ª–ª—ã)
- ‚úÖ –ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –ø–æ–∫—É–ø–∞—Ç–µ–ª—è–º
- ‚úÖ –ë—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É
- ‚úÖ VIP-–∫–ª–∏–µ–Ω—Ç—ã –∏ –¥–æ–ª–∂–Ω–∏–∫–∏

---

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–æ–¥–µ–ª–µ–π

### 1. CustomerGroup (–ì—Ä—É–ø–ø–∞ –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π)

–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Å–∫–∏–¥–æ–∫.

**–ü–æ–ª—è:**
- `name` - –ù–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã (VIP, –û–ø—Ç–æ–≤–∏–∫–∏, –ü–æ—Å—Ç–æ—è–Ω–Ω—ã–µ)
- `description` - –û–ø–∏—Å–∞–Ω–∏–µ –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤ –ø–æ–ø–∞–¥–∞–Ω–∏—è
- `discount_percent` - –ü—Ä–æ—Ü–µ–Ω—Ç –∞–≤—Ç–æ—Å–∫–∏–¥–∫–∏ (0-100%)
- `min_purchase_amount` - –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –¥–ª—è –ø–æ–ø–∞–¥–∞–Ω–∏—è –≤ –≥—Ä—É–ø–ø—É
- `is_active` - –ê–∫—Ç–∏–≤–Ω–∞ –ª–∏ –≥—Ä—É–ø–ø–∞

**–ü—Ä–∏–º–µ—Ä—ã –≥—Ä—É–ø–ø:**
```python
{
    "name": "VIP –∫–ª–∏–µ–Ω—Ç—ã",
    "discount_percent": 10,
    "min_purchase_amount": 1000000  # 1 –º–ª–Ω —Å—É–º
}
```

---

### 2. Customer (–ü–æ–∫—É–ø–∞—Ç–µ–ª—å)

–û—Å–Ω–æ–≤–Ω–∞—è –º–æ–¥–µ–ª—å –ø–æ–∫—É–ø–∞—Ç–µ–ª—è —Å –ø–æ–ª–Ω—ã–º –ø—Ä–æ—Ñ–∏–ª–µ–º.

**–û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–ª—è:**
- `first_name`, `last_name`, `middle_name` - –§–ò–û
- `customer_type` - –¢–∏–ø: `individual` (—Ñ–∏–∑. –ª–∏—Ü–æ) –∏–ª–∏ `company` (—é—Ä. –ª–∏—Ü–æ)
- `company_name`, `tax_id` - –î–ª—è —é—Ä–∏–¥–∏—á–µ—Å–∫–∏—Ö –ª–∏—Ü
- `phone` - –û—Å–Ω–æ–≤–Ω–æ–π —Ç–µ–ª–µ—Ñ–æ–Ω (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π!)
- `phone_2`, `email` - –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–Ω—Ç–∞–∫—Ç—ã
- `address`, `city`, `region`, `postal_code` - –ê–¥—Ä–µ—Å

**–§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –ø–æ–ª—è:**
- `balance` - –ë–∞–ª–∞–Ω—Å (+ –º—ã –¥–æ–ª–∂–Ω—ã, - –¥–æ–ª–∂–µ–Ω –∫–ª–∏–µ–Ω—Ç)
- `credit_limit` - –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –¥–æ–ª–≥–∞
- `available_credit` - –î–æ—Å—Ç—É–ø–Ω—ã–π –∫—Ä–µ–¥–∏—Ç (—Å–≤–æ–π—Å—Ç–≤–æ)
- `loyalty_points` - –ë–æ–Ω—É—Å–Ω—ã–µ –±–∞–ª–ª—ã
- `total_purchases` - –û–±—â–∞—è —Å—É–º–º–∞ –ø–æ–∫—É–ø–æ–∫
- `total_purchases_count` - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–∫—É–ø–æ–∫

**–°—Ç–∞—Ç—É—Å:**
- `is_active` - –ê–∫—Ç–∏–≤–µ–Ω –ª–∏ –ø–æ–∫—É–ø–∞—Ç–µ–ª—å
- `is_blocked` - –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω (–Ω–µ–ª—å–∑—è –ø—Ä–æ–¥–∞–≤–∞—Ç—å –≤ –∫—Ä–µ–¥–∏—Ç)

**–í—ã—á–∏—Å–ª—è–µ–º—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞:**
- `full_name` - –ü–æ–ª–Ω–æ–µ –∏–º—è
- `available_credit` - –î–æ—Å—Ç—É–ø–Ω—ã–π –∫—Ä–µ–¥–∏—Ç
- `is_vip` - VIP –∫–ª–∏–µ–Ω—Ç (—Å–∫–∏–¥–∫–∞ >= 10%)
- `default_discount` - –°–∫–∏–¥–∫–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏–∑ –≥—Ä—É–ø–ø—ã

---

### 3. CustomerTransaction (–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –ø–æ–∫—É–ø–∞—Ç–µ–ª—è)

–ò—Å—Ç–æ—Ä–∏—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —Å –±–∞–ª–∞–Ω—Å–æ–º.

**–¢–∏–ø—ã —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π:**
- `payment` - –ü–ª–∞—Ç—ë–∂ (–ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞)
- `charge` - –°–ø–∏—Å–∞–Ω–∏–µ (–ø–æ–∫—É–ø–∫–∞ –≤ –∫—Ä–µ–¥–∏—Ç)
- `bonus_accrual` - –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–æ–Ω—É—Å–æ–≤
- `bonus_redemption` - –°–ø–∏—Å–∞–Ω–∏–µ –±–æ–Ω—É—Å–æ–≤
- `correction` - –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞

**–ü–æ–ª—è:**
- `customer` - FK –∫ Customer
- `transaction_type` - –¢–∏–ø —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- `amount` - –°—É–º–º–∞
- `balance_before`, `balance_after` - –ë–∞–ª–∞–Ω—Å –¥–æ –∏ –ø–æ—Å–ª–µ
- `sale` - –°–≤—è–∑—å —Å –ø—Ä–æ–¥–∞–∂–µ–π (–µ—Å–ª–∏ –µ—Å—Ç—å)
- `description` - –û–ø–∏—Å–∞–Ω–∏–µ
- `performed_by` - –ö—Ç–æ –≤—ã–ø–æ–ª–Ω–∏–ª

**–ê–≤—Ç–æ–º–∞—Ç–∏–∫–∞:**
- –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç—Å—è –±–∞–ª–∞–Ω—Å –¥–æ –∏ –ø–æ—Å–ª–µ
- –ë–∞–ª–∞–Ω—Å –∫–ª–∏–µ–Ω—Ç–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

---

## üîå API Endpoints

### Customer Groups

```
GET    /api/customers/groups/              - –°–ø–∏—Å–æ–∫ –≥—Ä—É–ø–ø
POST   /api/customers/groups/              - –°–æ–∑–¥–∞—Ç—å –≥—Ä—É–ø–ø—É
GET    /api/customers/groups/{id}/         - –î–µ—Ç–∞–ª–∏ –≥—Ä—É–ø–ø—ã
PUT    /api/customers/groups/{id}/         - –û–±–Ω–æ–≤–∏—Ç—å –≥—Ä—É–ø–ø—É
DELETE /api/customers/groups/{id}/         - –£–¥–∞–ª–∏—Ç—å –≥—Ä—É–ø–ø—É
GET    /api/customers/groups/{id}/members/ - –ß–ª–µ–Ω—ã –≥—Ä—É–ø–ø—ã
```

### Customers

```
GET    /api/customers/customers/                   - –°–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π
POST   /api/customers/customers/                   - –°–æ–∑–¥–∞—Ç—å –ø–æ–∫—É–ø–∞—Ç–µ–ª—è
GET    /api/customers/customers/{id}/              - –î–µ—Ç–∞–ª–∏ –ø–æ–∫—É–ø–∞—Ç–µ–ª—è
PUT    /api/customers/customers/{id}/              - –û–±–Ω–æ–≤–∏—Ç—å –ø–æ–∫—É–ø–∞—Ç–µ–ª—è
DELETE /api/customers/customers/{id}/              - –£–¥–∞–ª–∏—Ç—å –ø–æ–∫—É–ø–∞—Ç–µ–ª—è

# –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
POST   /api/customers/customers/{id}/add_payment/  - –î–æ–±–∞–≤–∏—Ç—å –ø–ª–∞—Ç—ë–∂
POST   /api/customers/customers/{id}/charge/       - –°–ø–∏—Å–∞—Ç—å —Å –±–∞–ª–∞–Ω—Å–∞

# –ò—Å—Ç–æ—Ä–∏—è –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
GET    /api/customers/customers/{id}/transactions_history/  - –ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
GET    /api/customers/customers/{id}/stats/                 - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

# –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã
GET    /api/customers/customers/search_by_phone/?phone=+998901234567  - –ü–æ–∏—Å–∫ –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É
GET    /api/customers/customers/vip_customers/                         - VIP –∫–ª–∏–µ–Ω—Ç—ã
GET    /api/customers/customers/debtors/                               - –î–æ–ª–∂–Ω–∏–∫–∏
```

### Transactions

```
GET    /api/customers/transactions/              - –°–ø–∏—Å–æ–∫ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π (read-only)
GET    /api/customers/transactions/{id}/         - –î–µ—Ç–∞–ª–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
```

---

## üí° –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è API

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–∫—É–ø–∞—Ç–µ–ª—è (—Ñ–∏–∑. –ª–∏—Ü–æ)

```bash
POST /api/customers/customers/
Content-Type: application/json
Authorization: Bearer <token>
X-Tenant-Key: <tenant_key>

{
  "first_name": "–ò–≤–∞–Ω",
  "last_name": "–ò–≤–∞–Ω–æ–≤",
  "middle_name": "–ò–≤–∞–Ω–æ–≤–∏—á",
  "customer_type": "individual",
  "phone": "+998901234567",
  "email": "ivan@example.com",
  "address": "—É–ª. –õ–µ–Ω–∏–Ω–∞, 10",
  "city": "–¢–∞—à–∫–µ–Ω—Ç",
  "credit_limit": 500000,
  "birthday": "1990-05-15"
}
```

### 2. –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–∫—É–ø–∞—Ç–µ–ª—è (—é—Ä. –ª–∏—Ü–æ)

```bash
POST /api/customers/customers/
Content-Type: application/json

{
  "first_name": "–ê–ª–µ–∫—Å–µ–π",
  "last_name": "–ü–µ—Ç—Ä–æ–≤",
  "customer_type": "company",
  "company_name": "–û–û–û –†–æ–º–∞—à–∫–∞",
  "tax_id": "1234567890",
  "phone": "+998901234568",
  "email": "info@romashka.uz",
  "credit_limit": 5000000
}
```

### 3. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞ –ø–æ–∫—É–ø–∞—Ç–µ–ª—é

```bash
POST /api/customers/customers/1/add_payment/
Content-Type: application/json

{
  "amount": 100000,
  "description": "–û–ø–ª–∞—Ç–∞ –¥–æ–ª–≥–∞"
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "message": "–ü–ª–∞—Ç—ë–∂ —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω",
  "transaction": {
    "id": 15,
    "customer": 1,
    "transaction_type": "payment",
    "amount": "100000.00",
    "balance_before": "-50000.00",
    "balance_after": "50000.00",
    "created_at": "2025-11-16T10:30:00Z"
  },
  "new_balance": "50000.00"
}
```

### 4. –°–ø–∏—Å–∞–Ω–∏–µ —Å –±–∞–ª–∞–Ω—Å–∞ (–∫—Ä–µ–¥–∏—Ç–Ω–∞—è –ø—Ä–æ–¥–∞–∂–∞)

```bash
POST /api/customers/customers/1/charge/
Content-Type: application/json

{
  "amount": 75000,
  "description": "–ü–æ–∫—É–ø–∫–∞ –≤ –∫—Ä–µ–¥–∏—Ç"
}
```

### 5. –ü–æ–∏—Å–∫ –ø–æ–∫—É–ø–∞—Ç–µ–ª—è –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É

```bash
GET /api/customers/customers/search_by_phone/?phone=+998901234567
```

### 6. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ –ø–æ–∫—É–ø–∞—Ç–µ–ª—é

```bash
GET /api/customers/customers/1/stats/
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "customer": {
    "id": 1,
    "full_name": "–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á",
    "phone": "+998901234567",
    ...
  },
  "transactions": {
    "total_count": 25,
    "total_payments": "500000.00",
    "total_charges": "475000.00"
  },
  "financial": {
    "current_balance": "25000.00",
    "credit_limit": "500000.00",
    "available_credit": "475000.00",
    "loyalty_points": 4750
  },
  "purchases": {
    "total_amount": "475000.00",
    "total_count": 15,
    "last_purchase": "2025-11-15T14:20:00Z"
  }
}
```

### 7. –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–∏–∫–æ–≤

```bash
GET /api/customers/customers/debtors/
```

### 8. –ü–æ–ª—É—á–µ–Ω–∏–µ VIP –∫–ª–∏–µ–Ω—Ç–æ–≤

```bash
GET /api/customers/customers/vip_customers/
```

---

## üîç –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏ –ø–æ–∏—Å–∫

### –§–∏–ª—å—Ç—Ä—ã –¥–ª—è —Å–ø–∏—Å–∫–∞ –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π:

```bash
# –ü–æ –≥—Ä—É–ø–ø–µ
GET /api/customers/customers/?group=1

# –ü–æ —Ç–∏–ø—É
GET /api/customers/customers/?customer_type=company

# –ü–æ —Å—Ç–∞—Ç—É—Å—É
GET /api/customers/customers/?is_active=true&is_blocked=false

# –ü–æ–∏—Å–∫
GET /api/customers/customers/?search=–ò–≤–∞–Ω

# –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
GET /api/customers/customers/?ordering=-total_purchases  # –ü–æ —É–±—ã–≤–∞–Ω–∏—é —Å—É–º–º—ã –ø–æ–∫—É–ø–æ–∫
GET /api/customers/customers/?ordering=-last_purchase_at  # –ü–æ –ø–æ—Å–ª–µ–¥–Ω–µ–π –ø–æ–∫—É–ø–∫–µ
```

---

## üé® –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

–í –º–æ–¥–µ–ª–∏ —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã:

**Customer:**
- `phone` - –±—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É
- `email` - –ø–æ–∏—Å–∫ –ø–æ email
- `['last_name', 'first_name']` - –ø–æ–∏—Å–∫ –ø–æ –§–ò–û
- `company_name` - –ø–æ–∏—Å–∫ –ø–æ –∫–æ–º–ø–∞–Ω–∏–∏
- `group` - —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –≥—Ä—É–ø–ø–µ
- `['is_active', 'is_blocked']` - —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤
- `last_purchase_at` - —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

**CustomerGroup:**
- `is_active` - —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∞–∫—Ç–∏–≤–Ω—ã—Ö –≥—Ä—É–ø–ø
- `discount_percent` - —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ —Å–∫–∏–¥–∫–µ

**CustomerTransaction:**
- `['customer', 'created_at']` - –∏—Å—Ç–æ—Ä–∏—è –∫–ª–∏–µ–Ω—Ç–∞
- `transaction_type` - —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ç–∏–ø—É
- `sale` - —Å–≤—è–∑—å —Å –ø—Ä–æ–¥–∞–∂–µ–π
- `created_at` - —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞

---

## üîó –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Sales

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–æ–Ω—É—Å–æ–≤

–ü—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –ø—Ä–æ–¥–∞–∂–∏ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥:

```python
customer.add_purchase(sale.total_amount)
```

–≠—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- –£–≤–µ–ª–∏—á–∏—Ç `total_purchases`
- –£–≤–µ–ª–∏—á–∏—Ç `total_purchases_count`
- –û–±–Ω–æ–≤–∏—Ç `last_purchase_at`
- –ù–∞—á–∏—Å–ª–∏—Ç –±–æ–Ω—É—Å—ã (1% –æ—Ç —Å—É–º–º—ã)

### –ö—Ä–µ–¥–∏—Ç–Ω–∞—è –ø—Ä–æ–¥–∞–∂–∞

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ã–π –∫—Ä–µ–¥–∏—Ç:
```python
if sale.total_amount > customer.available_credit:
    raise ValidationError('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∫—Ä–µ–¥–∏—Ç–∞')
```

2. –°–æ–∑–¥–∞–π—Ç–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é —á–µ—Ä–µ–∑ API:
```python
POST /api/customers/customers/{id}/charge/
{
    "amount": sale.total_amount,
    "description": f"–ü–æ–∫—É–ø–∫–∞ (—á–µ–∫ #{sale.receipt_number})"
}
```

3. –°–≤—è–∂–∏—Ç–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é —Å –ø—Ä–æ–¥–∞–∂–µ–π (–≤ –º–æ–¥–µ–ª–∏ –µ—Å—Ç—å –ø–æ–ª–µ `sale`)

---

## üìù –ú–∏–≥—Ä–∞—Ü–∏–∏

–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤—ã–ø–æ–ª–Ω–∏:

```bash
# –ê–∫—Ç–∏–≤–∏—Ä—É–π venv
source venv/bin/activate

# –°–æ–∑–¥–∞–π –º–∏–≥—Ä–∞—Ü–∏–∏
python manage.py makemigrations customers

# –ü—Ä–∏–º–µ–Ω–∏ –º–∏–≥—Ä–∞—Ü–∏–∏
python manage.py migrate customers
```

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –≥—Ä—É–ø–ø
–°–æ–∑–¥–∞–π –±–∞–∑–æ–≤—ã–µ –≥—Ä—É–ø–ø—ã –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ:
- –†–æ–∑–Ω–∏—Ü–∞ (0% —Å–∫–∏–¥–∫–∏)
- –ü–æ—Å—Ç–æ—è–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç—ã (5%)
- VIP (10%)
- –û–ø—Ç–æ–≤–∏–∫–∏ (15%)

### 2. –ü—Ä–æ–≥—Ä–∞–º–º–∞ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏
- –ù–∞—á–∏—Å–ª—è–π 1% –±–æ–Ω—É—Å–∞–º–∏ –æ—Ç –∫–∞–∂–¥–æ–π –ø–æ–∫—É–ø–∫–∏
- –ü–æ–∑–≤–æ–ª—è–π –æ–ø–ª–∞—á–∏–≤–∞—Ç—å –±–æ–Ω—É—Å–∞–º–∏ –¥–æ 20% –æ—Ç —Å—É–º–º—ã

### 3. –ö—Ä–µ–¥–∏—Ç–Ω—ã–µ –ª–∏–º–∏—Ç—ã
- –î–ª—è —Ñ–∏–∑. –ª–∏—Ü: –¥–æ 500,000 —Å—É–º
- –î–ª—è —é—Ä. –ª–∏—Ü: –¥–æ 5,000,000 —Å—É–º
- –î–ª—è VIP: –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ

### 4. –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞
–ë–ª–æ–∫–∏—Ä—É–π –∫–ª–∏–µ–Ω—Ç–æ–≤ –ø—Ä–∏:
- –ü—Ä–æ—Å—Ä–æ—á–∫–µ –¥–æ–ª–≥–∞ > 30 –¥–Ω–µ–π
- –î–æ–ª–≥–µ > –∫—Ä–µ–¥–∏—Ç–Ω–æ–≥–æ –ª–∏–º–∏—Ç–∞

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –∏ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –∏—Ö**
2. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å API —á–µ—Ä–µ–∑ Swagger** (`/swagger/`)
3. **–°–æ–∑–¥–∞—Ç—å –±–∞–∑–æ–≤—ã–µ –≥—Ä—É–ø–ø—ã –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π**
4. **–ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å –º–æ–¥—É–ª–µ–º Sales**
5. **–î–æ–±–∞–≤–∏—Ç—å email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** (Celery tasks)
6. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∞–∫—Ü–∏–∏** –¥–ª—è VIP

---

–í—Å—ë –≥–æ—Ç–æ–≤–æ –∫ —Ä–∞–±–æ—Ç–µ! üéâ
