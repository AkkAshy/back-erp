# üìä –¢–æ–ø –ö–∞—Å—Å–∏—Ä–æ–≤ - API –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

## –û–±–∑–æ—Ä

–≠–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ –∫–∞—Å—Å–∏—Ä–∞–º, –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –ø–æ –æ–±—ä–µ–º—É –ø—Ä–æ–¥–∞–∂ (—Ç–æ–ø-–∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–∏).

---

## üîó –≠–Ω–¥–ø–æ–∏–Ω—Ç

```
GET /api/sales/sessions/cashier-stats/
```

–∏–ª–∏

```
GET /api/sales/shifts/cashier-stats/
```

*(–æ–±–∞ URL —Ä–∞–±–æ—Ç–∞—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤–æ, `shifts` - —ç—Ç–æ –∞–ª–∏–∞—Å –¥–ª—è `sessions`)*

---

## üìã Query Parameters

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –¢–∏–ø | –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|-----|--------------|--------------|----------|
| `date_from` | string | –ù–µ—Ç | –ù–∞—á–∞–ª–æ —Ç–µ–∫—É—â–µ–≥–æ –º–µ—Å—è—Ü–∞ | –î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ –ø–µ—Ä–∏–æ–¥–∞ |
| `date_to` | string | –ù–µ—Ç | –°–µ–π—á–∞—Å | –î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –ø–µ—Ä–∏–æ–¥–∞ |
| `limit` | integer | –ù–µ—Ç | –ë–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–ø-–∫–∞—Å—Å–∏—Ä–æ–≤ –¥–ª—è –≤—ã–≤–æ–¥–∞ |

**–§–æ—Ä–º–∞—Ç –¥–∞—Ç—ã:**
- `YYYY-MM-DD` (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è) - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è `00:00:00` –¥–ª—è `date_from` –∏ `23:59:59` –¥–ª—è `date_to`
- `YYYY-MM-DDTHH:MM:SS` - —Ç–æ—á–Ω–æ–µ –≤—Ä–µ–º—è (–¥–ª—è –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤)

---

## üì§ Response Format

```json
{
  "status": "success",
  "data": {
    "period": {
      "from": "2025-11-01T00:00:00+05:00",
      "to": "2025-11-30T23:59:59+05:00"
    },
    "cashiers": [
      {
        "id": 8,
        "full_name": "–ü–µ—Ç—Ä–æ–≤ –ò–≤–∞–Ω",
        "phone": "+998901234568",
        "role": "cashier",
        "total_sales": "1500000.00",
        "cash_sales": "0",
        "card_sales": "1500000.00",
        "sales_count": 1,
        "sessions_count": 1
      },
      {
        "id": 7,
        "full_name": "–ò–≤–∞–Ω–æ–≤ –ê–Ω—Ç–æ–Ω",
        "phone": "+998901234567",
        "role": "cashier",
        "total_sales": "1500000.00",
        "cash_sales": "1500000.00",
        "card_sales": "0",
        "sales_count": 2,
        "sessions_count": 1
      }
    ],
    "total_cashiers": 2
  }
}
```

---

## üìä –ü–æ–ª—è Response

### Period
- `from` - –ù–∞—á–∞–ª–æ –ø–µ—Ä–∏–æ–¥–∞ (ISO datetime —Å timezone)
- `to` - –ö–æ–Ω–µ—Ü –ø–µ—Ä–∏–æ–¥–∞ (ISO datetime —Å timezone)

### Cashiers (–º–∞—Å—Å–∏–≤)
- `id` - ID –∫–∞—Å—Å–∏—Ä–∞ (Employee)
- `full_name` - –ü–æ–ª–Ω–æ–µ –∏–º—è –∫–∞—Å—Å–∏—Ä–∞
- `phone` - –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞
- `role` - –†–æ–ª—å (`cashier`, `stockkeeper`)
- `total_sales` - –û–±—â–∞—è —Å—É–º–º–∞ –ø—Ä–æ–¥–∞–∂ (Decimal)
- `cash_sales` - –°—É–º–º–∞ –ø—Ä–æ–¥–∞–∂ –Ω–∞–ª–∏—á–Ω—ã–º–∏ (Decimal)
- `card_sales` - –°—É–º–º–∞ –ø—Ä–æ–¥–∞–∂ –ø–æ –∫–∞—Ä—Ç–µ (Decimal)
- `sales_count` - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–¥–∞–∂
- `sessions_count` - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Å–º–µ–Ω

### Meta
- `total_cashiers` - –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞—Å—Å–∏—Ä–æ–≤ –≤ —Å–ø–∏—Å–∫–µ

---

## üí° –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### 1. –¢–æ–ø 10 –∫–∞—Å—Å–∏—Ä–æ–≤ –∑–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü

```bash
curl -X GET "http://localhost:8000/api/sales/sessions/cashier-stats/?limit=10" \
  -H "Authorization: Bearer $TOKEN" \
  -H "X-Tenant-Key: test_shop_4dfa7a5a"
```

### 2. –¢–æ–ø 5 –∫–∞—Å—Å–∏—Ä–æ–≤ –∑–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥

```bash
# –ü—Ä–æ—Å—Ç–æ–π —Ñ–æ—Ä–º–∞—Ç (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
curl -X GET "http://localhost:8000/api/sales/sessions/cashier-stats/?date_from=2025-11-01&date_to=2025-11-30&limit=5" \
  -H "Authorization: Bearer $TOKEN" \
  -H "X-Tenant-Key: test_shop_4dfa7a5a"
```

### 3. –í—Å–µ –∫–∞—Å—Å–∏—Ä—ã –∑–∞ —Å–µ–≥–æ–¥–Ω—è

```bash
# –ü—Ä–æ—Å—Ç–æ —É–∫–∞–∂–∏—Ç–µ –æ–¥–Ω—É –∏ —Ç—É –∂–µ –¥–∞—Ç—É
curl -X GET "http://localhost:8000/api/sales/sessions/cashier-stats/?date_from=2025-11-19&date_to=2025-11-19" \
  -H "Authorization: Bearer $TOKEN" \
  -H "X-Tenant-Key: test_shop_4dfa7a5a"
```

### 4. –¢–æ–ø 3 –∫–∞—Å—Å–∏—Ä–∞ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π

```bash
# –ü–æ–ª—É—á–∞–µ–º –¥–∞—Ç—É 7 –¥–Ω–µ–π –Ω–∞–∑–∞–¥ (–ø—Ä–æ—Å—Ç–æ–π —Ñ–æ—Ä–º–∞—Ç)
DATE_FROM=$(date -u -d '7 days ago' +%Y-%m-%d)
DATE_TO=$(date -u +%Y-%m-%d)

curl -X GET "http://localhost:8000/api/sales/sessions/cashier-stats/?date_from=$DATE_FROM&date_to=$DATE_TO&limit=3" \
  -H "Authorization: Bearer $TOKEN" \
  -H "X-Tenant-Key: test_shop_4dfa7a5a"
```

### 5. –ü—Ä–∏–º–µ—Ä –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ (JavaScript)

```javascript
// –§—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ–ø –∫–∞—Å—Å–∏—Ä–æ–≤
async function getTopCashiers(dateFrom, dateTo, limit = 10) {
  // –§–æ—Ä–º–∞—Ç –¥–∞—Ç—ã: YYYY-MM-DD (–ø—Ä–æ—â–µ –≤—Å–µ–≥–æ!)
  const params = new URLSearchParams({
    date_from: dateFrom,  // –ù–∞–ø—Ä–∏–º–µ—Ä: "2025-11-01"
    date_to: dateTo,      // –ù–∞–ø—Ä–∏–º–µ—Ä: "2025-11-30"
    limit: limit
  });

  const response = await api.get(`/sales/sessions/cashier-stats/?${params}`);
  return response.data.data;
}

// –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è: —Ç–æ–ø 5 –∫–∞—Å—Å–∏—Ä–æ–≤ –∑–∞ —Å–µ–≥–æ–¥–Ω—è
const today = new Date().toISOString().split('T')[0]; // "2025-11-19"
const stats = await getTopCashiers(today, today, 5);

console.log(`–¢–æ–ø ${stats.total_cashiers} –∫–∞—Å—Å–∏—Ä–æ–≤ –∑–∞ ${today}:`);
stats.cashiers.forEach((cashier, index) => {
  console.log(`${index + 1}. ${cashier.full_name}: ${cashier.total_sales} —Å—É–º`);
  console.log(`   –ü—Ä–æ–¥–∞–∂: ${cashier.sales_count}, –ù–∞–ª–∏—á–Ω—ã–µ: ${cashier.cash_sales}, –ö–∞—Ä—Ç–∞: ${cashier.card_sales}`);
});
```

---

## üîç –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

1. **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è:**
   - –£—á–∏—Ç—ã–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ –ø—Ä–æ–¥–∞–∂–∏ (`status='completed'`)
   - –£—á–∏—Ç—ã–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–æ–¥–∞–∂–∏ —Å –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–º –∫–∞—Å—Å–∏—Ä–æ–º (`cashier__isnull=False`)
   - –§–∏–ª—å—Ç—Ä –ø–æ –¥–∞—Ç–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫ –ø–æ–ª—é `created_at` –ø—Ä–æ–¥–∞–∂–∏

2. **–ê–≥—Ä–µ–≥–∞—Ü–∏—è:**
   - –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –∫–∞—Å—Å–∏—Ä—É (`cashier__id`)
   - –ü–æ–¥—Å—á–µ—Ç –æ–±—â–µ–π —Å—É–º–º—ã –ø—Ä–æ–¥–∞–∂ (`total_amount`)
   - –ü–æ–¥—Å—á–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø—Ä–æ–¥–∞–∂
   - –ü–æ–¥—Å—á–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Å–º–µ–Ω

3. **–°–ø–æ—Å–æ–±—ã –æ–ø–ª–∞—Ç—ã:**
   - –î–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–∞—Å—Å–∏—Ä–∞ –æ—Ç–¥–µ–ª—å–Ω–æ –ø–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è —Å—É–º–º–∞ –Ω–∞–ª–∏—á–Ω—ã—Ö (`cash`)
   - –ò —Å—É–º–º–∞ –±–µ–∑–Ω–∞–ª–∏—á–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π (`card`)

4. **–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞:**
   - –ü–æ —É–±—ã–≤–∞–Ω–∏—é `total_sales` (—Ç–æ–ø-–∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–∏ –ø–µ—Ä–≤—ã–º–∏)

5. **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ:**
   - –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è `limit` –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö

---

## üéØ Use Cases

### –î–ª—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞
- –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ª—É—á—à–∏—Ö –∫–∞—Å—Å–∏—Ä–æ–≤ –∑–∞ –ø–µ—Ä–∏–æ–¥
- –°—Ä–∞–≤–Ω–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∫–∞—Å—Å–∏—Ä–æ–≤
- –ê–Ω–∞–ª–∏–∑ –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ–º—ã—Ö —Å–ø–æ—Å–æ–±–æ–≤ –æ–ø–ª–∞—Ç—ã –∫–∞–∂–¥–æ–≥–æ –∫–∞—Å—Å–∏—Ä–∞

### –î–ª—è –≤–ª–∞–¥–µ–ª—å—Ü–∞
- KPI –æ—Ç—á–µ—Ç—ã –ø–æ –∫–∞—Å—Å–∏—Ä–∞–º
- –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–µ–º–∏–π –∏ –±–æ–Ω—É—Å–æ–≤
- –í—ã—è–≤–ª–µ–Ω–∏–µ —Å–ª–∞–±—ã—Ö –º–µ—Å—Ç –≤ —Ä–∞–±–æ—Ç–µ –∫–∞—Å—Å–∏—Ä–æ–≤

### –î–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
- Dashboard —Å —Ç–æ–ø-5 –∫–∞—Å—Å–∏—Ä–æ–≤ –∑–∞ –¥–µ–Ω—å/–Ω–µ–¥–µ–ª—é/–º–µ—Å—è—Ü
- –ì—Ä–∞—Ñ–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- Leaderboard (—Ç–∞–±–ª–∏—Ü–∞ –ª–∏–¥–µ—Ä–æ–≤)

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–§–æ—Ä–º–∞—Ç –¥–∞—Ç—ã (YYYY-MM-DD):**
   - –î–ª—è `date_from` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è `T00:00:00` (–Ω–∞—á–∞–ª–æ –¥–Ω—è)
   - –î–ª—è `date_to` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è `T23:59:59` (–∫–æ–Ω–µ—Ü –¥–Ω—è)
   - ‚úÖ **–ü—Ä–∞–≤–∏–ª—å–Ω–æ:** `?date_from=2025-11-01&date_to=2025-11-30`
   - ‚ùå **–û—à–∏–±–∫–∞:** `?date_from=2025-11-01&date_to=2025-11-30T00:00:00` (–±—É–¥–µ—Ç –ø—Ä–æ–ø—É—â–µ–Ω –≤–µ—Å—å –¥–µ–Ω—å 30-–≥–æ!)
   - –ï—Å–ª–∏ –Ω—É–∂–Ω–æ —Ç–æ—á–Ω–æ–µ –≤—Ä–µ–º—è, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ–ª–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç `YYYY-MM-DDTHH:MM:SS`

2. **–ù–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ —Å Sale.cashier:**
   - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–µ–ø–µ—Ä—å –æ—Å–Ω–æ–≤–∞–Ω–∞ –Ω–∞ –ø–æ–ª–µ `Sale.cashier`, –∞ –Ω–µ `CashierSession.cashier`
   - –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ç–æ—á–Ω–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å, –∫—Ç–æ –∏–º–µ–Ω–Ω–æ —Å–¥–µ–ª–∞–ª –∫–∞–∂–¥—É—é –ø—Ä–æ–¥–∞–∂—É
   - –ù–µ—Å–∫–æ–ª—å–∫–æ –∫–∞—Å—Å–∏—Ä–æ–≤ –º–æ–≥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞ –æ–¥–Ω–æ–π —Å–º–µ–Ω–µ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ

3. **–ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö:**
   - –°—Ç–∞—Ä—ã–µ –ø—Ä–æ–¥–∞–∂–∏ –±–µ–∑ `cashier` –Ω–µ –±—É–¥—É—Ç —É—á–∏—Ç—ã–≤–∞—Ç—å—Å—è –≤ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ
   - –¢–æ–ª—å–∫–æ –ø—Ä–æ–¥–∞–∂–∏, —Å–æ–∑–¥–∞–Ω–Ω—ã–µ –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—è `Sale.cashier`, –±—É–¥—É—Ç —É—á—Ç–µ–Ω—ã

4. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
   - –ó–∞–ø—Ä–æ—Å –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ Django ORM
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `Coalesce()` –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ NULL –∑–Ω–∞—á–µ–Ω–∏–π
   - –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î (2 –∑–∞–ø—Ä–æ—Å–∞: –æ—Å–Ω–æ–≤–Ω–æ–π + –ø–ª–∞—Ç–µ–∂–∏)

5. **Timezone:**
   - –í—Å–µ –¥–∞—Ç—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è —Å —É—á–µ—Ç–æ–º timezone —Å–µ—Ä–≤–µ—Ä–∞
   - –ü—Ä–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è timezone

---

## üîê –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è:** Bearer token (JWT)
- **–ó–∞–≥–æ–ª–æ–≤–æ–∫:** `X-Tenant-Key` —Å –∫–ª—é—á–æ–º –º–∞–≥–∞–∑–∏–Ω–∞
- **–ü—Ä–∞–≤–∞:** –õ—é–±–æ–π –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–∞–≥–∞–∑–∏–Ω–∞ (–≤–∫–ª—é—á–∞—è staff)

---

## üìù –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- **View:** `/sales/views.py:288-374` (`CashierSessionViewSet.cashier_stats()`)
- **Model:** `/sales/models.py` (Sale, Payment, Employee)
- **URL:** `/sales/urls.py:16` (router –¥–ª—è sessions/shifts)

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-11-19
**–ê–≤—Ç–æ—Ä:** Claude Code
**–í–µ—Ä—Å–∏—è:** 1.0
